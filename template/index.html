<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transmisión de Video</title>
</head>

<body>
    <h1>Enviando Video desde la Cámara</h1>
    <video id="video" width="640" height="480" autoplay></video>

    <script>
        // Acceder a la cámara del celular
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                document.getElementById('video').srcObject = stream;

                // Aquí capturamos los frames de la cámara y los enviamos por UDP o WebSocket
                const videoTrack = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(videoTrack);

                // Capturar frames cada 100ms
                setInterval(() => {
                    imageCapture.grabFrame()
                        .then(imageBitmap => {
                            // Convertir el frame a JPEG o PNG
                            canvas = document.createElement('canvas');
                            canvas.width = imageBitmap.width;
                            canvas.height = imageBitmap.height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(imageBitmap, 0, 0);

                            // Convertir el frame a base64 (o directamente a bytes)
                            const jpegData = canvas.toDataURL('image/jpeg', 0.9); // Imagen en formato JPEG

                            // Aquí deberías enviar el frame por UDP o WebSocket
                            sendFrameToServer(jpegData);
                        })
                        .catch(err => console.log('Error al capturar el frame:', err));
                }, 100);  // Capturar un frame cada 100ms
            })
            .catch(err => {
                console.error("Error accediendo a la cámara:", err);
            });

        // Función para enviar los frames por WebSocket (o UDP)
        function sendFrameToServer(frameData) {
            // Enviar por WebSocket (simple ejemplo)
            const socket = new WebSocket('ws://localhost:8765');  // Cambia la IP y puerto a tu servidor
            socket.onopen = () => {
                socket.send(frameData);  // Enviar el frame como base64 o binario
            };
        }
    </script>
</body>

</html>